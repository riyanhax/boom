<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="js/jquery-3.4.0.min.js"></script>
    <script src="js/mypage.js"></script>
    <link rel="stylesheet" href="css/mypage.css" />
    <script src="cordova.js"></script>
    <title>Document</title>
</head>
<body>
    <div class = "mypage">
    <div id = "QRcodeimg" class = "QRcode">
        <img src = "img/QRcode.JPG" width = "100%" height = "150px">

    </div>
    <div id = "profile">
        <div id = "profileleft" class = "profile">
            <img src = "img/human.jpg" width = "50px" height = "50px" align = "left">
            <label id = "nick">haehong</label><br/>
            <label id = "juso">대구 달서구 장기동</label>
        </div>
        <div id = "profileright" class = "profile">
            <canvas id = "manner" width = "140px" height = "50px">manner</canvas>
        </div>
        </div>
        <div id = "naeyeok">
        <div id = "panmae">
            <button id = "panmaenae">판매내역</button>
        </div>
        <div id = "gumae">
            <button id = "gumaenae">구매내역</button>
        </div>
        </div>
        <div id = "zicple">
            <div id = "zicpleb">
                <button id = "zicplebtn">직플레이스 등록</button>
            </div>

            <button id = "scan">QR 스캐너</button>
            <div class="alert">ㅎㅎ</div>
        </div>


    </div>
<button id = "logout" value = "로그아웃">로그아웃</button>

<script>
$('#scan').click(function(){
    cordova.plugins.barcodeScanner.scan(
        function(result) {
            var list = $("<ul>").append("<li>" + result.text + "</li>")
                .append("<li>" + result.format + "</li>")
                .append("<li>" + result.cancelled + "</li>");
            
            $(".alert").html(list);
            
            var nickname = JSON.parse(sessionStorage.getItem('member')).nickname;
            var url = result.text + '&nickname=' + nickname;
            alert(url);
            var ref = cordova.InAppBrowser.open(url, '_blank', 'location=yes');
            ref.addEventListener('loadstop', function(){
                var loop = window.setInterval(function(){
                    ref.executeScript({
                        code:"window.shouldClose"
                    },
                    function(values){
                        if(values[0]){
                            ref.close();
                            window.clearInterval(loop);
                        }
                    });
                },100);
            });
        },
        function(error) {
            // 에러정보 표시
            $(".alert").html(error);
        }
    );
});

</script>
</body>
</html>